\input{woodamble}                                                       % Custom preamble
%----------------------------------------------------------------------------------------
% NAME AND CLASS SECTION
%----------------------------------------------------------------------------------------

\newcommand{\reportTitle}{Final Report} % Assignment title
\newcommand{\reportDueDate}{Wednesday,\ September\ 03,\ 2014}                    % Due date
\newcommand{\reportClass}{EEE3061W - Mechatronics Design}                               % Course/class
\newcommand{\reportClassTime}{10:30am}                                 % Class/lecture time
\newcommand{\reportClassInstructor}{Jones}                               % Teacher/lecturer
\newcommand{\reportAuthorName}{Team 13}                           % Your name
\newcommand{\reportDepartment}{Department of Electrical Engineering}           % Department

%----------------------------------------------------------------------------------------
% TITLE PAGE
%----------------------------------------------------------------------------------------

\title{
\begin{figure}[H]
  \begin{center}
    \includegraphics[width=0.4\columnwidth]{uct-logo}
  \end{center}
\end{figure}
\textmd{\Huge UNIVERSITY OF CAPE TOWN \\ \LARGE \reportDepartment} \\
\vspace{2in}
\textmd{\textbf{\LARGE \reportClass \\ \Huge Biathlon Robot \\ \reportTitle \\ \vspace{1.5in} \Large Team 13 \\  WDXSEA003 \textbar\space PRSSAM004 \textbar\space RJDYAR001 \textbar\space STRIBR001}}\\
}

\date{}

%========================================================================================
%========================================================================================

\begin{document}
  \maketitle
  \thispagestyle{empty}

\frontmatter
%----------------------------------------------------------------------------------------
% ABTRACT
%----------------------------------------------------------------------------------------
\setcounter{tocdepth}{3}                                                      % ToC Depth
\setcounter{secnumdepth}{2}                                     % Section Numbering Depth

\clearpage
\section*{Plaigiarism Declaration}
\addcontentsline{toc}{section}{Plaigiarism Declaration}
\label{sec:Plaigiarism Declaration}

\clearpage
\begin{figure}[H]
  \begin{center}
    \includegraphics[width=1\columnwidth]{BLUV3}
  \end{center}
\end{figure}

\begin{figure}[H]
  \begin{center}
    \includegraphics[width=1\columnwidth]{IMG_20151009_092409}
  \end{center}
\end{figure}


\begin{abstract}
  \thispagestyle{empty}
  This report covers the post-design commentary and as-built designs of an autonomous bi-athletic robot for the EEE3061W Mechatronics Design Project 2015.  This robot was to partake in a sprint as well as launch a ping-pong ball after tracking a line and being aware of the end of the course. Most of the specifications were met and the robot performed the tasks that were set out at the beginning of the project.

\end{abstract}

%----------------------------------------------------------------------------------------
% TABLE OF CONTENTS
%----------------------------------------------------------------------------------------

\cleardoublepage
\addcontentsline{toc}{section}{Table of Contents}
\tableofcontents

\clearpage
\section*{List of Illustrations}
\addcontentsline{toc}{section}{List of Illustrations}
\label{sec:List of Illustrations}
\addcontentsline{toc}{subsection}{List of Figures}
\listoffigures
\clearpage

%----------------------------------------------------------------------------------------
% GLOSSARY
%----------------------------------------------------------------------------------------

%----------------------------------------------------------------------------------------
% INTRODUCTION
%----------------------------------------------------------------------------------------
\mainmatter
\clearpage
\section{Introduction}
\label{sec:Introduction}
  This report covers post-testing commentary and as-built designs for EEE3061W Mechatronics Design Project for 2015.  The project involved the design, manufacture and testing of a legged, autonomous, bi-athletic robot that was be able to partake in a 5m sprint, follow a line then throw a ping-pong ball.  The robot was to adhere to a set of specifications as provided by the course management. \\

  The entire project was split into two sections, each covering the semester's task.  The first section involved the sprinting aspect of the robot, and the second involved line following and launching.

  \subsection{Sprinter Introduction}
  \label{sub:Sprinter Introduction}
    In summary, the sprinting robot was to make use of a digital 3-axis gyroscope in an attempt to sprint 5m as fast as possible within a f ixed-width lane (maintain fixed heading).  The robot was also specified to start the sprint when the green light from a set of three lights was detected, signaling the beginning of the race. \\

    The locomotion design was constrained to the use of legs, making use of a mechanical linkage-type system to convert rotational motion from the provided motors into linear motion to move forward.  Other restrictions included the dimensions of the entire robot and out-of-pocket components budget.

  \subsection{Launcher Introduction}
  \label{sub:Launcher Introduction}
    The second stage of the project required the robot to first navigate along a line (autonomously) into a box and then throw a ping-pong ball as far as possible. The launching mechanism was limited to the use of a lever system, driven by a DC motor provided.  The rest of the restrictions follow from the Sprinter as well. \\

  The development of both robots followed the same design process whereby 3 conceptual designs were proposed and one final design (or a combination of ideas from more than one) was developed upon further after having drawn up a pros and cons comparison.  The final design was, at this stage, separated into the electronic and mechanical aspects.  As such, they are discussed separately.  Mechanical designs were modelled using SolidWorks and the electronic systems were drawn up in Altium Designer.

%----------------------------------------------------------------------------------------
% ELECTRICAL COMMENTARY
%----------------------------------------------------------------------------------------
\clearpage
\section{Electrical Commentary}
\label{sec:Electrical Commentary}
  Electrical systems for both semester's worth of design were on Printed Circuit Boards (PCBs), the first semester's PCBs being manufactured using the ``press-n-peel'' method and the second semester PCBs being manufactured professionally at Trax\footnote{Trax PCB Manufacture - \url{http://www.trax.co.za/}}. Both systems worked successfully after manufacture and minimal changes were made to the PCBs for the final demonstrations of the robot. Commentary on both systems and the associated software that was written for the systems can be found below.

  \subsection{Electrical System Design}
  \label{sub:Electrical System Design}
    \subsubsection{PCB Manufacturing Process}
    \label{subs:PCB Manufacturing Process}
      As stated, the PCBs manufactured for the first semester's robot were made using copper clad board and ``press-n-peel'' paper. This constrained the design of the boards since the manufacturing process was much more error prone. The track width minimum was increased greatly, decreasing the allowable complexity of the board layout thus increasing the overall size. Using this method also meant that the boards could not be double sided, further decreasing the complexity given the size.\\

      The second semester saw the PCBs manufactured professionally at Trax. This allowed a much smaller minimum track width and clearance limit (0.254mm) and could be manufactured double-sided with vias as well as a silk screen and solder mask. This gave the boards a much more professional feel, with easier assembly due to the silk screen and solder mask.

    \subsubsection{Power Supply Toplogy}
    \label{subs:Power Supply Toplogy}
      The addition of far more functionality in the second semester system meant the system drew a significantly larger amount of current excluding that of the motors. This saw the 12-5V regulation phase (LM317) dissipating a very large amount of heat, which is characteristic of linear voltage regulators operating at the level experienced. Use of a switched mode power supply would have reduced the power dissipation and minimised the need for a heat sink which took up an unnecessary amount of space on the final system.

    \subsubsection{Surface Mount Components}
    \label{subs:Surface Mount Components}
      The second semester system used surface mount forms of most of the passive electrical components in the system which had a huge impact on the final size of the boards. This was made possible by the professional manufacture process. The STM32F051C6 remained as a pluggable daughter board with two rows of headers. The STM32F0 could have been soldered directly to the main ControllerBoard which would have saved a lot of space, at least vertically.

  \subsection{Software Design}
  \label{sub:Software Design}
    \subsubsection{Software Structure}
    \label{subs:Software Structure}
      All software was written in C for the STM32F051C6. The software system written for the 1st semester robot was single-threaded and made use of a ``super-loop'' type layout, where initialisations were performed at the beginning and the main execution looped through in one loop with calls to various custom written libraries throughout. This suited the task as the level of complexity was not high, however, many parts of the super-loop became unused as the sequence progressed (such as checking for the green light).\\

      A more advanced method of scheduling was used in the second semester system to better suit the multi-functional nature of the newer system. The FreeRTOS\textsuperscript{\cite{freeRTOS}} kernel was implemented to bring to the system the ability to split the program into multiple threads (or tasks) which minimised the scheduling implications of a super-loop style program. Calls to the FreeRTOS source base were made using the CMSIS RTOS API specially written for the STM range of microcontrollers which worked well except for having to manually implement some unfinished feature inclusions in the API.\\

      The GitHub Repository used throughout the project can be found at \url{https://github.com/WoodyWoodsta/EEE3061WDesignProject/tree/master/Code}.

    \subsubsection{Control Methodology}
    \label{subs:Control Methodology}
      For both maintaining a fixed heading and line following, the control loop types were intended to be PID and this type of control was implemented fully in both software systems. However, in both cases, the system to control turned out to be too complex to model and thus only the proportional component of the control loops were used. This sufficed for both the straight line test as well as following a curved line with the sensors.



%----------------------------------------------------------------------------------------
% MECHANICAL COMMENTARY
%----------------------------------------------------------------------------------------
\clearpage
\section{Mechanical Commentary}
\label{sec:Mechanical Commentary}
The mechanical design consisted mainly of the leg mechanism attached to a generic base and later a launcher was added to the center. The mechanism chosen for the legs was based off a Klann linkage\textsuperscript{\cite{klannLinkage}} which is common amongst walking robots. The mechanism converts rotary motion to linear motion which replicates moving legs. The primary difficulty with this mechanism was the non-fluid motion of the Klann linkage design. With regards to the first semester design, these limitations meant high stress concentrations were created at critical points within the linkage. As a result, the central leg linkage was fractured during testing. Other complications with the design centered on the high friction generated between moving parts. This was partly due to the choice of material but mostly as a result of the small scale of the robot relative to the external and internal forces generated.\\

Apart from this, the rest of the robot functioned relatively well from the first iteration. The calculated gear ratio was accurate because the required torque needed to overcome the weight of the robot was reached from the first design.\\

\subsection{Linkage Size and Strength}
\label{sub:Linkage Size and Strength}
  From the post design work it was apparent that the linkage size, particularly around the interfaces with other links was insufficient in the first design. We also learnt that having moving parts made of Perspex in direct contact with each other was conducive to high friction generation. As well as this, despite the gears functioning appropriately, there was significant difficulty in locating the gears. In the first design, Perspex was attached using epoxy perpendicularly to the Perspex base. This interface had to be reattached multiple times as the material used was not ideal for epoxy attachments.\\

  To address the main problem of linkage fracture, the size of each linkage interface as well as the linkages themselves was increased. This was done to rectify any stress concentrations that may have developed during usage due to misalignment. Additionally, the carbon fiber rods were replaced with standard nuts and bolts in all shaft requirements. The friction generated within linkages due to the carbon fiber rods resulted in the degradation of the holes within linkages which contributed significantly to the misalignment problem. To further alleviate this problem, brass bushings were placed in every hole within the Perspex. To assist with the gear location, hex shaped holes were cut into the Perspex and a hex nut was force fit into it. This allowed the gear to be threaded onto the bar easily, and could be kept in place using lock nuts. Between each of the linkages, a stationary Perspex spacer was placed to prevent direct contact between them. This not only significantly reduced the friction but also assisted in maintaining linkage alignment.\\

\subsection{Body Size}
\label{sub:Body Size}
  The overall size of the robot was increased to accommodate the launcher mechanism. This was necessary to ensure optimal functionality and performance of both the launcher and the leg mechanism. Worm gears were included in the leg mechanism due to the increased weight of the robot and therefore the increased need for more torque. The compromise was that the overall speed of the robot was heavily sacrificed.

%----------------------------------------------------------------------------------------
% RESULTS AND CONCLUSIONS
%----------------------------------------------------------------------------------------
\clearpage
\section{Results and Conclusions}
\label{sec:Results and Conclusions}
  \subsection{Sprinter Results}
  \label{sub:Sprinter Results}
    The robot built for the 1st semester demonstration was able to remain within the demarcated track width autonomously and do so at a reasonable pace. The robot successfully completed the race after sensing the green light in variable ambient conditions.\\

    Apart from a fractured leg that occurred during the demonstrations, the robot was able to continue to perform.

  \subsection{Launcher Results}
  \label{sub:Launcher Results}
    The robot built for the 2nd semester demonstration was able to start following the line after the light was sensed and the line following was very successful. It achieved this autonomously and was able to sense the box marking on the floor and move into the box. The robot was then able to throw the ping pong ball after reaching the edge of the box to complete the task.


%----------------------------------------------------------------------------------------
% BIBLIOGRAPHY
%----------------------------------------------------------------------------------------
\clearpage
% \nocite{*}
\printbibliography


%----------------------------------------------------------------------------------------
% APPENDICES
%----------------------------------------------------------------------------------------
\section{APPENDIX A: Final Electrical Schematics}
\label{sec:APPENDIX A: Final Electrical Schematics}
  \subsection{1st Semester Electrical Schematics}
  \label{sub:1st Semester Electrical Schematics}

    \begin{figure}[H]
      \begin{center}
        \makebox[\textwidth][c]{\includegraphics[width=1.4\textwidth, angle=90]{PowerBoardSchematic}}
        \caption{Schematic of the PowerBoard in the 1st Semester Electrical System}
        \label{fig:PowerBoardSchematic}
      \end{center}
    \end{figure}

    \begin{figure}[H]
      \begin{center}
        \makebox[\textwidth][c]{\includegraphics[width=1.5\textwidth, angle=90]{ControllerBoardSchematic}}
        \caption{Schematic of the ControllerBoard in the 1st Semester Electrical System}
        \label{fig:ControllerBoardSchematic}
      \end{center}
    \end{figure}

  \subsection{2nd Semester Electrical Schematics}
  \label{sub:2nd Semester Electrical Schematics}

    \begin{figure}[H]
      \begin{center}
        \makebox[\textwidth][c]{\includegraphics[width=1.4\textwidth, angle=90]{PowerBoardSchematicV2}}
        \caption{Schematic of the PowerBoard in the 2nd Semester Electrical System}
        \label{fig:PowerBoardSchematicV2}
      \end{center}
    \end{figure}

    \begin{figure}[H]
      \begin{center}
        \makebox[\textwidth][c]{\includegraphics[width=1.5\textwidth, angle=90]{ControllerBoardV2Schematic}}
        \caption{Schematic of the ControllerBoard in the 2nd Semester Electrical System}
        \label{fig:ControllerBoardV2Schematic}
      \end{center}
    \end{figure}

    \begin{figure}[H]
      \begin{center}
        \makebox[\textwidth][c]{\includegraphics[width=1.5\textwidth, angle=90]{LineSensorBoardSchematic}}
        \caption{Schematic of the SensorBoard in the 2nd Semester Electrical System}
        \label{fig:LineSensorBoardSchematic}
      \end{center}
    \end{figure}

    \begin{figure}[H]
      \begin{center}
        \includegraphics[width=0.9\columnwidth]{LineSensorModuleSchematic}
        \caption{Schematic of the SensorModule in the 2nd Semester Electrical System}
        \label{fig:LineSensorModuleSchematic}
      \end{center}
    \end{figure}

\clearpage
\section{APPENDIX B: Final Electrical PCB Designs}
\label{sec:APPENDIX B: Final Electrical PCB Designs}
  \subsection{1st Semester Electrical PCB Designs}
  \label{sub:1st Semester Electrical PCB Designs}

    \begin{figure}[H]
      \begin{center}
        \makebox[\textwidth][c]{\includegraphics[width=1.5\textwidth]{PowerBoardPCBRev1}}
        \caption{PCB Layout of the PowerBoard in the 1st Semester Electrical System}
        \label{fig:PowerBoardPCBRev1}
      \end{center}
    \end{figure}

    \begin{figure}[H]
      \begin{center}
        \makebox[\textwidth][c]{\includegraphics[width=1.5\textwidth]{ControllerBoardPCB}}
        \caption{PCB Layout of the ControllerBoard in the 1st Semester Electrical System}
        \label{fig:ControllerBoardPCB}
      \end{center}
    \end{figure}

  \subsection{2nd Semester Electrical PCB Designs}
  \label{sub:2nd Semester Electrical PCB Designs}

    \begin{figure}[H]
      \begin{center}
        \makebox[\textwidth][c]{\includegraphics[width=1.2\textwidth]{PowerBoardPCBV2}}
        \caption{PCB Layout of the PowerBoard in the 2nd Semester Electrical System}
        \label{fig:PowerBoardPCBV2}
      \end{center}
    \end{figure}

    \begin{figure}[H]
      \begin{center}
        \makebox[\textwidth][c]{\includegraphics[width=1.9\textwidth]{ControllerBoardV2PCB}}
        \caption{PCB Layout of the ControllerBoard in the 2nd Semester Electrical System}
        \label{fig:ControllerBoardV2PCB}
      \end{center}
    \end{figure}

    \begin{figure}[H]
      \begin{center}
        \makebox[\textwidth][c]{\includegraphics[width=1.5\textwidth]{LineSensorBoardPCBRev2}}
        \caption{PCB Layout of the SensorBoard in the 2nd Semester Electrical System}
        \label{fig:LineSensorBoardPCBRev2}
      \end{center}
    \end{figure}

    \begin{figure}[H]
      \begin{center}
        \makebox[\textwidth][c]{\includegraphics[width=0.9\textwidth]{SensorModulePCB}}
        \caption{PCB Layout of the SensorModule in the 2nd Semester Electrical System}
        \label{fig:SensorModulePCB}
      \end{center}
    \end{figure}


\clearpage
\section{APPENDIX C: Final Mechanical Drawings}
\label{sec:APPENDIX C: Final Mechanical Drawings}


\end{document}
%----------------------------------------------------------------------------------------
% INSTRUCTIONS AND TEMPLATE COMPONENTS
%----------------------------------------------------------------------------------------

% Set space - \vspace{length}
% Horizontal line - \hrule
% Pagebreak - \clearpage or \newpage - they seem to do the same thing

% Normal equation:
% \begin{equation}
%   p = \frac{p_g - k}{m}
% \end{equation}

% Aligned equation:
% \begin{equation}
%   \begin{split}
%     \rho_5  & = -\frac{\left(1575-1900\right)}{g\left(105\e{-3}-70\e{-3}\right)}\\
%             & = 946.56 \text{ kg/m\(^{-3}\)}\\
%     \rho_6  & = -\frac{\left(1900-2150\right)}{g\left(70\e{-3}-42\e{-3}\right)}\\
%             & = 910.15 \text{ kg/m\(^{-3}\)}\\
%   \end{split}
% \end{equation}

% Table: Can get from the table site!
% \begin{table}[h]
% \centering
% \begin{tabular}{cccc}
% \multicolumn{4}{c}{\cellcolor[HTML]{EFEFEF}DATA MEASUREMENTS} \\ \hline
% \multicolumn{1}{c|}{\begin{tabular}[c]{@{}c@{}}Known Weight \\ Pressure (Psi)\end{tabular}} & \multicolumn{1}{c|}{\begin{tabular}[c]{@{}c@{}}Known Weight\\ Pressure (Bar)\end{tabular}} & \multicolumn{1}{c|}{\begin{tabular}[c]{@{}c@{}}Gauge Pressure\\ (Psi)\end{tabular}} & \begin{tabular}[c]{@{}c@{}}Gauge Pressure\\ (Bar)\end{tabular} \\ \hline
% \multicolumn{1}{c|}{22} & \multicolumn{1}{c|}{1.52} & \multicolumn{1}{c|}{9.43} & 0.65 \\
% \multicolumn{1}{c|}{\textbf{27}} & \multicolumn{1}{c|}{\textbf{1.86}} & \multicolumn{1}{c|}{\textbf{13.78}} & \textbf{0.95} \\
% \multicolumn{1}{c|}{32} & \multicolumn{1}{c|}{2.21} & \multicolumn{1}{c|}{17.40} & 1.20 \\
% \multicolumn{1}{c|}{37} & \multicolumn{1}{c|}{2.55} & \multicolumn{1}{c|}{21.76} & 1.50 \\
% \multicolumn{1}{c|}{42} & \multicolumn{1}{c|}{2.90} & \multicolumn{1}{c|}{26.11} & 1.80 \\
% \multicolumn{1}{c|}{47} & \multicolumn{1}{c|}{3.24} & \multicolumn{1}{c|}{29.01} & 2.00 \\
% \multicolumn{1}{c|}{\textbf{52}} & \multicolumn{1}{c|}{\textbf{3.59}} & \multicolumn{1}{c|}{\textbf{33.36}} & \textbf{2.30} \\
% \multicolumn{1}{c|}{57} & \multicolumn{1}{c|}{3.93} & \multicolumn{1}{c|}{37.71} & 2.60 \\ \hline
% \end{tabular}
% \caption{Dead weight tester and gauge measurements}
% \label{gaugeMeasurements}
% \end{table}

% Picture:
% \begin{figure}[H]
%   \begin{center}
%     \includegraphics[width=0.4\columnwidth]{MEC2022SLab1Exp1}
%     \caption{Apparatus}
%     \label{liquidDiagram}
%   \end{center}
% \end{figure}

% Graph:
% \begin{figure}[H]
%   \centering
%   \begin{tikzpicture}
%     \begin{axis}[
%       xlabel=Known Weight (Psi),
%       ylabel=Reading (Psi),
%       grid=major]
%     \addplot[color=red, smooth] coordinates {
%       (22,9.43)
%       (27,13.78)
%     };
%     \addlegendentry{Gauge}

%     \addplot[color=blue, dashed, smooth] coordinates {
%       (22,22)
%       (27,27)
%     };
%     \addlegendentry{Known weight}

%     \end{axis}
%   \end{tikzpicture}
%   \caption{Dead weight tester and gauge measurements}
%   \label{gaugePlot}
% \end{figure}

% Indented Text: (bit of a hacky way to do it)
% \begin{quote}
% where \(p_g\) is the gauge reading, \(m\) is the error coefficient, \(p\) is the known (``correct'') pressure and \(k\) is the error constant
% \end{quote}

% Code Snippet:
% \begin{minted}{c}
%   void main(void) {
%     init_leds();
%
%     while (TRUE) {
%       __asm("nop");
%     }
%   }
% \end{minted}

% Bibliography:
% \begin{thebibliography}{99}
%   \bibitem{itemname}
%   Author,
%   Date.
%   \emph{Title}.
%   Edition.
%   Press.
%   \url{http://web.iitd.ac.in/~shouri/eel201/tuts/diode_switch.pdf}
% \end{thebibliography}
